; ENTRADA DE TECLADO - INPUT.INC


.CODE

; LEER TECLADO

LEER_TECLADO PROC
    MOV AH, 01H
    INT 16H
    JZ NO_TECLA
    
    MOV AH, 00H
    INT 16H
    
   
    CMP AL, 'w'
    JE ES_W
    CMP AL, 'W'
    JE ES_W
    
    CMP AL, 's'
    JE ES_S
    CMP AL, 'S'
    JE ES_S
    
    CMP AL, 'a'
    JE ES_A
    CMP AL, 'A'
    JE ES_A
    
    CMP AL, 'd'
    JE ES_D
    CMP AL, 'D'
    JE ES_D
    
    CMP AL, 'e'
    JE ES_E
    CMP AL, 'E'
    JE ES_E
    
    CMP AL, 27      ; ESC
    JE ES_ESC
    
    JMP NO_TECLA

ES_W:
    JMP MOVER_ARRIBA

ES_S:
    JMP MOVER_ABAJO

ES_A:
    JMP MOVER_IZQUIERDA

ES_D:
    JMP MOVER_DERECHA

ES_E:
    JMP ABRIR_INVENTARIO

ES_ESC:
    JMP SALIR_JUEGO

NO_TECLA:
    RET


; ABRIR INVENTARIO

ABRIR_INVENTARIO:
    CALL MOSTRAR_INVENTARIO_COMPLETO
    RET


; RUTINAS DE MOVIMIENTO

MOVER_ARRIBA:
    MOV DIRECCION, 2
    SUB JUGADOR_Y, 2
    CALL VERIFICAR_COLISION
    JNC MOVIMIENTO_OK_ARRIBA
    ; Verificar si es agua (AL = 2)
    CMP AL, 2
    JE MUERTE_POR_AGUA
    ADD JUGADOR_Y, 2
    RET
MOVIMIENTO_OK_ARRIBA:
    ; Solo redibujar el área afectada
    CALL REDIBUJAR_PARCIAL
    RET

MOVER_ABAJO:
    MOV DIRECCION, 3
    ADD JUGADOR_Y, 2
    CALL VERIFICAR_COLISION
    JNC MOVIMIENTO_OK_ABAJO
    ; Verificar si es agua (AL = 2)
    CMP AL, 2
    JE MUERTE_POR_AGUA
    SUB JUGADOR_Y, 2
    RET
MOVIMIENTO_OK_ABAJO:
    CALL REDIBUJAR_PARCIAL
    RET

MOVER_IZQUIERDA:
    MOV DIRECCION, 1
    SUB JUGADOR_X, 2
    CALL VERIFICAR_COLISION
    JNC MOVIMIENTO_OK_IZQ
    ; Verificar si es agua (AL = 2)
    CMP AL, 2
    JE MUERTE_POR_AGUA
    ADD JUGADOR_X, 2
    RET
MOVIMIENTO_OK_IZQ:
    CALL REDIBUJAR_PARCIAL
    RET

MOVER_DERECHA:
    MOV DIRECCION, 0
    ADD JUGADOR_X, 2
    CALL VERIFICAR_COLISION
    JNC MOVIMIENTO_OK_DER
    ; Verificar si es agua (AL = 2)
    CMP AL, 2
    JE MUERTE_POR_AGUA
    SUB JUGADOR_X, 2
    RET
MOVIMIENTO_OK_DER:
    CALL REDIBUJAR_PARCIAL
    RET

MUERTE_POR_AGUA:
    ; Llamar a la pantalla de GAME OVER
    ; (esta función nunca retorna - o reinicia o sale)
    CALL PANTALLA_GAME_OVER
    ; Este código nunca debería ejecutarse
    RET


; REDIBUJAR SOLO LA PARTE QUE CAMBIO

REDIBUJAR_PARCIAL PROC
    ; Borrar posición anterior del jugador
    CALL BORRAR_JUGADOR_ANTERIOR
    
    ; Dibujar jugador en nueva posición
    CALL DIBUJAR_JUGADOR
    
    ; Actualizar posición anterior
    MOV AX, JUGADOR_X
    MOV JUGADOR_X_ANTERIOR, AX
    MOV AX, JUGADOR_Y
    MOV JUGADOR_Y_ANTERIOR, AX
    
    RET
REDIBUJAR_PARCIAL ENDP

SALIR_JUEGO:
    MOV AX, 4C00H
    INT 21H

LEER_TECLADO ENDP