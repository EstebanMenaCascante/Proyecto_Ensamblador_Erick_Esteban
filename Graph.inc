; RUTINAS GRAFICAS - GRAPHICS.INC


.DATA
    COLOR_NEGRO EQU 0
    COLOR_AZUL EQU 1
    COLOR_VERDE EQU 2
    COLOR_ROJO EQU 4
    COLOR_MARRON EQU 6
    COLOR_GRIS EQU 8
    COLOR_AMARILLO EQU 14
    COLOR_BLANCO EQU 15

.CODE

; INICIAR MODO GRAFICO EGA

INICIAR_MODO_GRAFICO PROC
    MOV AX, 0010H
    INT 10H
    RET
INICIAR_MODO_GRAFICO ENDP


; LIMPIAR PANTALLA

LIMPIAR_PANTALLA PROC
    MOV AX, 0600H
    MOV BH, COLOR_NEGRO
    MOV CX, 0000H
    MOV DX, 184FH
    INT 10H
    RET
LIMPIAR_PANTALLA ENDP


; DIBUJAR FRAME COMPLETO

DIBUJAR_FRAME_COMPLETO PROC
    CALL LIMPIAR_PANTALLA
    CALL DIBUJAR_MAPA_COMPLETO
    CALL DIBUJAR_RECURSOS
    CALL DIBUJAR_JUGADOR
    CALL DIBUJAR_HUD
    RET
DIBUJAR_FRAME_COMPLETO ENDP


; DIBUJAR MAPA COMPLETO 

DIBUJAR_MAPA_COMPLETO PROC
    PUSH AX
    PUSH BX
    PUSH CX
    PUSH DX
    PUSH SI
    PUSH DI
    
    MOV SI, 0        ; Índice del mapa
    MOV DX, 0        ; Y inicial
    
PROXIMA_FILA_MAPA:
    CMP DX, 240      ; 15 filas * 16px = 240px
    JAE FIN_MAPA
    
    MOV CX, 0        ; X inicial
    MOV DI, 0        ; Contador columnas
    
PROXIMA_COLUMNA_MAPA:
    CMP DI, 20     
    JAE SIGUIENTE_FILA
    
    ; Obtener tile
    MOV AL, MAPA_DATOS[SI]
    
    ; Elegir color
    CMP AL, 0
    JE DIBUJAR_TIERRA
    CMP AL, 1
    JE DIBUJAR_PIEDRA
    CMP AL, 2
    JE DIBUJAR_AGUA
    CMP AL, 3
    JE DIBUJAR_HIERBA
    JMP DIBUJAR_TILE

DIBUJAR_TIERRA:
    MOV AL, COLOR_MARRON
    JMP DIBUJAR_TILE

DIBUJAR_PIEDRA:
    MOV AL, COLOR_GRIS
    JMP DIBUJAR_TILE

DIBUJAR_AGUA:
    MOV AL, COLOR_AZUL
    JMP DIBUJAR_TILE

DIBUJAR_HIERBA:
    MOV AL, COLOR_VERDE

DIBUJAR_TILE:
    ; Dibujar tile 16x16
    PUSH CX
    PUSH DX
    PUSH SI
    MOV SI, CX       ; Guardar X
    MOV BX, DX       ; Guardar Y
    MOV CX, 16       ; Alto
    
DIBUJAR_FILA_TILE:
    PUSH SI
    MOV DX, BX
    MOV AH, 0CH
    MOV BH, 0
    MOV DI, 16       ; Ancho
    
DIBUJAR_PIXEL_TILE:
    INT 10H
    INC SI
    DEC DI
    JNZ DIBUJAR_PIXEL_TILE
    
    POP SI
    INC BX
    LOOP DIBUJAR_FILA_TILE
    
    POP SI
    POP DX
    POP CX

    ; Siguiente tile
    ADD CX, 16
    INC SI
    INC DI
    JMP PROXIMA_COLUMNA_MAPA

SIGUIENTE_FILA:
    ADD DX, 16
    JMP PROXIMA_FILA_MAPA

FIN_MAPA:
    POP DI
    POP SI
    POP DX
    POP CX
    POP BX
    POP AX
    RET
DIBUJAR_MAPA_COMPLETO ENDP

; DIBUJAR HUD

DIBUJAR_HUD PROC
    PUSH AX
    PUSH BX
    PUSH CX
    PUSH DX
    
  
    MOV CX, 0
    MOV DX, 240      
    MOV AL, COLOR_BLANCO
    MOV AH, 0CH
    MOV BX, 320
    
DIBUJAR_LINEA_HUD:
    INT 10H
    INC CX
    DEC BX
    JNZ DIBUJAR_LINEA_HUD
    
    POP DX
    POP CX
    POP BX
    POP AX
    RET
DIBUJAR_HUD ENDP